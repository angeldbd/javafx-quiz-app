<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ProgressIndicator?>
<?import javafx.scene.control.TreeTableColumn?>
<?import javafx.scene.control.TreeTableView?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<AnchorPane fx:id="rootPane"
            maxHeight="-Infinity" maxWidth="-Infinity" 
            minHeight="-Infinity" minWidth="-Infinity" 
            prefHeight="700.0" prefWidth="1000.0" 
            styleClass="container-main"
            stylesheets="@../css/JavaQuiz.css"
            xmlns="http://javafx.com/javafx/24.0.1" 
            xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="org.openjfx.javaquiz.controller.ResultController">
   
   <children>
      <!-- BotÃ³n X para cerrar (esquina superior derecha) -->
      <Button fx:id="closeBtn" 
              text="âœ•" 
              styleClass="btn-close"
              AnchorPane.topAnchor="8.0" 
              AnchorPane.rightAnchor="8.0"
              mnemonicParsing="false"/>
      
      <!-- Contenedor principal -->
      <VBox spacing="24" AnchorPane.topAnchor="32" AnchorPane.bottomAnchor="32" 
            AnchorPane.leftAnchor="32" AnchorPane.rightAnchor="32">
         
         <!-- TÃ­tulo -->
         <Label text="ðŸ“Š Resultados del Quiz" styleClass="title-medium">
            <font>
               <Font name="Segoe UI Semibold" size="32" />
            </font>
         </Label>
         
         <!-- SecciÃ³n superior: GrÃ¡fico + Tabla -->
         <HBox spacing="24" VBox.vgrow="SOMETIMES">
            
            <!-- GrÃ¡fico de barras -->
            <VBox spacing="8" HBox.hgrow="ALWAYS">
               <BarChart fx:id="barChart" 
                        prefHeight="280.0"
                        title="Resultados por Tema"
                        legendVisible="true"
                        HBox.hgrow="ALWAYS">
                  <xAxis>
                     <CategoryAxis label="Tema" side="BOTTOM" />
                  </xAxis>
                  <yAxis>
                     <NumberAxis label="Respuestas" side="LEFT" />
                  </yAxis>
               </BarChart>
            </VBox>
            
            <!-- Tabla de estadÃ­sticas -->
            <VBox spacing="8">
               <Label text="Detalle por Tema" 
                      style="-fx-font-weight: 600; -fx-font-size: 16px;">
                  <font>
                     <Font size="16" />
                  </font>
               </Label>
               
               <TreeTableView fx:id="tableViewId" 
                             prefWidth="280.0" 
                             prefHeight="280.0">
                  <columns>
                     <TreeTableColumn fx:id="topicColumn" 
                                     text="Tema" 
                                     prefWidth="120.0" />
                     <TreeTableColumn fx:id="correctColumn" 
                                     text="âœ“ Correctas" 
                                     prefWidth="80.0" />
                     <TreeTableColumn fx:id="wrongColumn" 
                                     text="âœ— Incorrectas" 
                                     prefWidth="80.0" />
                  </columns>
               </TreeTableView>
            </VBox>
            
         </HBox>
         
         <!-- Mensaje de feedback -->
         <VBox alignment="CENTER" spacing="8" styleClass="stats-card">
            <Label fx:id="remark" 
                   wrapText="true" 
                   textAlignment="CENTER"
                   maxWidth="700"
                   style="-fx-font-size: 18px; -fx-text-fill: #475569;">
               <font>
                  <Font size="18" />
               </font>
            </Label>
         </VBox>
         
         <!-- EstadÃ­sticas principales -->
         <HBox spacing="32" alignment="CENTER">
            
            <!-- Puntaje total -->
            <VBox alignment="CENTER" spacing="8" styleClass="stats-card" 
                  style="-fx-background-color: linear-gradient(135deg, rgba(91, 79, 255, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);">
               <Label text="Puntaje" 
                      style="-fx-font-size: 14px; -fx-text-fill: #7C3AED; -fx-font-weight: 600;">
                  <font>
                     <Font size="14" />
                  </font>
               </Label>
               
               <Label fx:id="marks" 
                      text="8/10" 
                      styleClass="stats-label-big">
                  <font>
                     <Font name="Segoe UI Bold" size="48" />
                  </font>
               </Label>
               
               <Label fx:id="markstext" 
                      text="8 puntos" 
                      style="-fx-font-size: 16px; -fx-text-fill: #5B4FFF;">
                  <font>
                     <Font size="16" />
                  </font>
               </Label>
            </VBox>
            
            <!-- Respuestas correctas -->
            <VBox alignment="CENTER" spacing="12" styleClass="stats-card"
                  style="-fx-background-color: rgba(16, 185, 129, 0.1);">
               <Label text="âœ“ Correctas" 
                      style="-fx-font-size: 14px; -fx-text-fill: #059669; -fx-font-weight: 600;">
                  <font>
                     <Font size="14" />
                  </font>
               </Label>
               
               <ProgressIndicator fx:id="correct_progress" 
                                 styleClass="progress-correct"
                                 minHeight="100.0" 
                                 minWidth="100.0" 
                                 progress="0.8"/>
               
               <Label fx:id="correcttext" 
                      text="Correct: 8" 
                      styleClass="stats-label-medium, stats-label-correct">
                  <font>
                     <Font size="18" />
                  </font>
               </Label>
            </VBox>
            
            <!-- Respuestas incorrectas -->
            <VBox alignment="CENTER" spacing="12" styleClass="stats-card"
                  style="-fx-background-color: rgba(239, 68, 68, 0.1);">
               <Label text="âœ— Incorrectas" 
                      style="-fx-font-size: 14px; -fx-text-fill: #DC2626; -fx-font-weight: 600;">
                  <font>
                     <Font size="14" />
                  </font>
               </Label>
               
               <ProgressIndicator fx:id="wrong_progress" 
                                 styleClass="progress-wrong"
                                 minHeight="100.0" 
                                 minWidth="100.0" 
                                 progress="0.2"/>
               
               <Label fx:id="wrongtext" 
                      text="Wrong: 2" 
                      styleClass="stats-label-medium, stats-label-wrong">
                  <font>
                     <Font size="18" />
                  </font>
               </Label>
            </VBox>
            
         </HBox>
         
         <!-- BotÃ³n reiniciar -->
         <HBox alignment="CENTER">
            <Button fx:id="restart" 
                    text="ðŸ”„ Intentar de Nuevo" 
                    styleClass="btn-primary"
                    prefWidth="250.0"
                    prefHeight="60.0"
                    mnemonicParsing="false" 
                    onAction="#restartQuiz">
               <font>
                  <Font name="Segoe UI Semibold" size="18" />
               </font>
            </Button>
         </HBox>
         
      </VBox>
   </children>
</AnchorPane>